# MorphBar 專案開發規劃

## 專案概述

MorphBar 是一個漢堡選單圖示動畫生成器，允許使用者視覺化設計 menu ↔ close 狀態的變形動畫，並自動生成 HTML/CSS/JS 程式碼。

---

## 目前專案狀態

### ✅ 已完成功能

- [x] 基礎編輯器：拖曳控制點編輯路徑
- [x] 雙狀態切換：Menu / Close 模式
- [x] 即時預覽：ControlsSidebar 顯示動畫效果
- [x] 程式碼生成：支援 checkbox 和 class 兩種方法
- [x] 自訂 class 名稱
- [x] 點對點對應視覺化：Hover 時顯示連接線和對應點高亮
- [x] Grid snap：5px 網格吸附
- [x] Shift 鍵軸向鎖定:水平/垂直移動限制
- [x] 重置功能
- [x] 面板切換：Design / Code
- [x] **多點路徑系統**：每條線段支援多個錨點（不再限制 2 點）
- [x] **三種編輯工具**：Select（選擇拖曳）、Pen+（新增點）、Pen-（刪除點）
- [x] **點編輯功能**：
  - 點擊路徑中間插入新點
  - 點擊頭尾點後可延伸新點
  - Pen+ 新增的點可立即拖曳
  - 刪除點時至少保留 2 點
- [x] **視覺回饋強化**：
  - Hover 點時放大並提高亮度
  - Focus 點時顯示脈動光暈
  - Pen+ 預覽顯示 + icon
  - Pen- hover 可刪除點時顯示 - icon
  - Crosshair cursor（Pen+ 模式下 focus 頭尾點時）
- [x] **Toast 通知系統**：使用 react-toastify 顯示錯誤訊息

### 📊 目前架構限制

1. **線段數量固定**：硬編碼為 3 條線（`type Lines = [LineState, LineState, LineState]`）
2. ~~**點數固定**：每條線固定 2 個端點（`menu: [Point, Point]`）~~ ✅ 已解決（支援多點路徑）
3. **無樣式自訂**：線條顏色、粗細、背景色等無法調整
4. **單點編輯**：一次只能拖曳一個點

---

## 功能需求清單與難度評估

### 🟢 第一階段：低風險功能（不改核心架構）

| 編號 | 功能                       | 難度 | 優先級 | 狀態      |
| ---- | -------------------------- | ---- | ------ | --------- |
| 1    | 反轉線段                   | ⭐   | High   | 📝 待開發 |
| 14   | 對調線段位置               | ⭐   | Medium | 📝 待開發 |
| 15   | Light Mode 主題切換        | ⭐   | High   | 📝 待開發 |
| 12   | Code 增加輸出大小設定      | ⭐⭐ | Medium | 📝 待開發 |
| 4    | 增加線段數量（最多 10 條） | ⭐⭐ | High   | 📝 待開發 |

#### 功能細節

**1. 反轉線段** ⭐

- **說明**：交換線段的起點和終點
- **影響範圍**：
  - 新增按鈕於 ControlsSidebar
  - 簡單的陣列操作：`[p1, p2]` → `[p2, p1]`
- **UI 位置**：每條線段旁的操作按鈕

**14. 對調線段位置** ⭐

- **說明**：交換線段在陣列中的順序（影響渲染層級）
- **實作方式**：
  - 下拉選單選擇兩條線段
  - 或拖曳排序 UI
- **影響**：線段顏色順序會改變

**15. Light Mode 主題切換** ⭐

- **說明**：提供亮色/暗色主題切換
- **實作方式**：
  - Header 新增主題切換按鈕（使用 Lucide 圖示：Sun/Moon）
  - 使用 CSS 變數管理色彩系統
  - LocalStorage 儲存使用者偏好
- **影響範圍**：
  - 全域樣式變數
  - 編輯器背景與網格顏色
  - 控制面板配色
  - 程式碼面板配色

**12. Code 輸出大小設定** ⭐⭐

- **說明**：允許設定生成程式碼中的 SVG 尺寸
- **UI 位置**：Code Panel
- **修改檔案**：
  - `src/utils/generator.ts:92-96` - CSS 中的 width/height
  - 新增 `size` 參數到 `generateCode` 函數

**4. 增加線段數量（最多 10 條）** ⭐⭐

- **說明**：動態新增/刪除線段
- **架構變更**：
  - `type Lines = LineState[]` （移除固定長度限制）
  - 新增顏色配置系統（目前只有 3 色：red/cyan/yellow）
- **UI 設計**：
  - "+ Add Line" 按鈕
  - 每條線段旁的 "🗑️ Delete" 按鈕
  - 顏色選擇器（或自動循環顏色）

---

### 🟡 第二階段：中等難度（部分改架構）

| 編號 | 功能                         | 難度         | 優先級 | 狀態      |
| ---- | ---------------------------- | ------------ | ------ | --------- |
| 3    | 鏡射（水平/垂直）            | ⭐⭐⭐       | Medium | 📝 待開發 |
| 6    | Menu/Close 水平移動距離      | ⭐⭐⭐       | Low    | 📝 待開發 |
| 2    | 快速調整 Hamburger 間距      | ⭐⭐⭐       | Low    | 🤔 需討論 |
| 13   | Preview 區塊（不同顏色預覽） | ⭐⭐⭐⭐     | Medium | 📝 待開發 |
| 5    | 對齊輔助線                   | ⭐⭐⭐⭐⭐   | High   | 📝 待開發 |
| 11   | Style Panel（樣式設定）      | ⭐⭐⭐⭐⭐   | High   | 📝 待開發 |
| 7    | 框選複數點移動               | ⭐⭐⭐⭐⭐⭐ | Medium | 📝 待開發 |

#### 功能細節

**2. 快速調整 Hamburger 間距** ⭐⭐⭐ 🤔

- **疑慮**：此功能僅適用於「標準漢堡選單」形狀
- **問題**：當使用者自由編輯後，「間距」定義不明確
- **建議替代方案**：
  - **選項 A**：改為「預設模板系統」
    - 提供模板：標準漢堡、箭頭、加號、X 型
    - 每個模板有參數可調（間距、寬度）
  - **選項 B**：限定使用情境
    - 僅在「3 條水平線」狀態下顯示此功能
    - 自動檢測是否符合標準形狀
- **需要決策**：選擇哪個方案？

**3. 鏡射（水平/垂直）** ⭐⭐⭐

- **參數**：
  - 鏡射軸：中間線（y=50）或指定線段
  - 鏡射方向：水平 / 垂直
  - 選擇目標線段
- **數學公式**：
  - 水平鏡射：`newY = axisY + (axisY - oldY)`
  - 垂直鏡射：`newX = axisX + (axisX - oldX)`
- **UI 設計挑戰**：選擇介面較複雜

**6. Menu/Close 水平移動距離** ⭐⭐⭐

- **說明**：批次調整特定狀態的 X 軸偏移
- **UI**：兩個 slider
  - Menu X Offset: -50 ~ +50
  - Close X Offset: -50 ~ +50
- **用途**：快速調整展開/收合時的水平位置

**5. 對齊輔助線** ⭐⭐⭐⭐⭐

- **功能**：拖曳時顯示虛線輔助對齊
- **偵測項目**：
  - 水平對齊（相同 y 座標）
  - 垂直對齊（相同 x 座標）
  - 中心對齊（x=50, y=50）
  - 與其他點對齊
- **實作要點**：
  - 設定容差範圍（例如 ±2px）
  - 即時計算效能優化
  - Snap to guide 功能

**11. Style Panel** ⭐⭐⭐⭐⭐

- **11.1 線段樣式**：
  - 顏色選擇器
  - 粗細調整（stroke-width）
  - **架構變更**：需在 `LineState` 新增 `style` 欄位
- **11.2 背景與外框**：
  - 背景色
  - 外框設定（border, border-radius）
- **11.3 全域樣式**：
  - 需新增 `GlobalStyle` 型別
  - 影響 Code 生成輸出

**13. Preview 區塊** ⭐⭐⭐⭐

- **功能**：即時預覽實際動畫效果
- **設計**：
  - 主題切換：Light / Dark / Custom
  - 實際可點擊的動畫
  - 顯示在 Design 或 Code 面板？
- **挑戰**：需整合實際的 CSS 動畫

**7. 框選複數點移動** ⭐⭐⭐⭐⭐⭐

- **功能**：
  - 矩形框選多個點
  - Shift+Click 多選
  - 同步拖曳所有選中的點
- **架構變更**：
  - `draggedPoint` → `draggedPoints: DraggedPoint[]`
  - 計算相對位移
- **UI 參考**：Figma / Illustrator 的框選

---

### 🔴 第三階段：高難度（需要重構核心）

| 編號 | 功能                   | 難度                 | 優先級 | 狀態        |
| ---- | ---------------------- | -------------------- | ------ | ----------- |
| 10   | 選線段旋轉             | ⭐⭐⭐⭐⭐⭐⭐       | Low    | 📝 待開發   |
| 9    | 形狀生成（圓/方/菱形） | ⭐⭐⭐⭐⭐⭐⭐⭐     | Low    | 📝 待開發   |
| 8    | 增加轉折點（多點路徑） | ⭐⭐⭐⭐⭐⭐⭐⭐⭐⭐ | High   | 🟡 部分完成 |

#### 功能細節

**8. 增加轉折點（多點路徑系統）** 🟡 部分完成

- ✅ **Phase 1: 多點路徑架構（已完成）**
  - 已完成架構重構，支援動態數量的錨點
  - 型別系統支援 `anchor` 和 `control` 兩種點（目前僅使用 anchor）

- **已完成的架構變更**：

  ```typescript
  interface PathPoint {
    x: number;
    y: number;
    type: 'anchor' | 'control'; // 錨點 vs 控制點
  }

  interface LineState {
    menu: PathPoint[]; // 從固定 2 點改為動態陣列
    close: PathPoint[];
  }
  ```

- **已實作功能**：
  - ✅ `EditorCanvas.tsx` - 多點路徑渲染（直線連接）
  - ✅ `generator.ts` - 支援多點路徑的程式碼生成
  - ✅ 三種編輯工具：Select / Pen+ / Pen-
  - ✅ 點擊路徑插入新點（自動找最近線段）
  - ✅ 頭尾點延伸功能
  - ✅ 點 Focus 狀態與視覺回饋
  - ✅ Toast 錯誤提示（刪除限制）

- ⏳ **Phase 2: 貝茲曲線控制點（待實作）**
  - 新增 control 類型的點
  - 拖曳錨點時自動生成/調整控制點
  - SVG 路徑改用 C（cubic bezier）命令
  - 控制點手把的視覺化與拖曳

**10. 選線段旋轉** ⭐⭐⭐⭐⭐⭐⭐

- **UI**：旋轉控制把手
- **數學**：旋轉矩陣
  ```
  x' = cos(θ) * (x - cx) - sin(θ) * (y - cy) + cx
  y' = sin(θ) * (x - cx) + cos(θ) * (y - cy) + cy
  ```
- **問題**：
  - 旋轉中心點如何決定？
  - 是否同時旋轉 menu 和 close 兩個狀態？

**9. 形狀生成** ⭐⭐⭐⭐⭐⭐⭐⭐

- **支援形狀**：
  - 圓形：三角函數計算圓周點
  - 正方形 / 菱形：幾何計算
- **參數**：尺寸、位置
- **問題**：
  - 套用到 menu 還是 close？
  - 如何保持兩狀態的對應關係？

---

## 建議開發順序

### Sprint 1：動態線段系統 ✨

**目標**：讓線段數量可擴充

- [ ] 功能 #15：Light Mode 主題切換
- [ ] 功能 #4：增加線段數量（最多 10 條）
- [ ] 功能 #1：反轉線段
- [ ] 功能 #14：對調線段位置
- [ ] 功能 #12：Code 輸出大小設定

**預估時間**：2-3 天
**風險**：低

---

### Sprint 2：編輯體驗優化 🎨

**目標**：提升編輯器易用性

- [ ] 功能 #5：對齊輔助線
- [ ] 功能 #3：鏡射功能
- [ ] 功能 #6：水平移動距離調整

**預估時間**：2-3 天
**風險**：中等（效能優化需注意）

---

### Sprint 3：樣式自訂系統 🎨

**目標**：讓使用者自訂視覺樣式

- [ ] 功能 #11：Style Panel
  - [ ] 11.1 線段顏色、粗細
  - [ ] 11.2 背景色
  - [ ] 11.3 外框設定
- [ ] 功能 #13：Preview 區塊

**預估時間**：3-4 天
**風險**：中高（需改架構）
**架構變更**：新增 `style` 欄位到 `LineState`

---

### Sprint 4：進階編輯功能 🚀

**目標**：專業級編輯能力

- [ ] 功能 #7：框選複數點移動
- [ ] 功能 #10：線段旋轉
- [ ] 功能 #9：形狀生成

**預估時間**：4-5 天
**風險**：高

---

### 🔥 獨立評估：轉折點功能

**功能 #8：增加轉折點**

**⚠️ 重要決策點**：

- 此功能需要**完全重構核心型別系統**
- 會影響 80% 的現有程式碼
- 建議獨立分支開發，或在專案早期決定是否實作

**如果要做，必須最先做！**

---

## 待確認的設計決策

### 1. 功能 #2：Hamburger 間距調整

- [ ] 選擇方案：預設模板系統 vs 限定使用情境
- [ ] 需要哪些預設模板？

### 2. 功能 #8：轉折點

- [ ] 是否確定要支援多點路徑？
- [ ] 允許 menu/close 有不同點數嗎？
- [ ] 支援的曲線類型？

### 3. 功能 #11：Style Panel

- [ ] 樣式是「全域」還是「每條線獨立」？
- [ ] 需要支援漸變色嗎？

### 4. 功能 #13：Preview 位置

- [ ] Preview 要獨立面板還是整合到現有面板？
- [ ] 需要多少預設主題？

---

## 技術債務與重構建議

### 近期可做

1. **型別系統**：`Lines` 改為動態陣列
2. **顏色系統**：移除硬編碼的 3 色限制
3. **元件拆分**：EditorCanvas 過於龐大，考慮拆分
4. **主題系統**：建立 CSS 變數架構，支援 Light/Dark Mode

### 長期規劃

1. **狀態管理**：考慮引入 Zustand/Jotai（當功能複雜化後）
2. **效能優化**：大量點時的渲染優化
3. **Undo/Redo**：操作歷史記錄

---

## 檔案結構概覽

```
src/
├── components/
│   ├── EditorCanvas.tsx          # 主編輯器（拖曳、渲染）
│   ├── EditorCanvas.module.scss  # 編輯器樣式
│   ├── ControlsSidebar.tsx       # 控制面板
│   ├── CodePanel.tsx             # 程式碼面板
│   └── ui/
│       ├── Button.tsx
│       └── SegmentedControl.tsx
├── utils/
│   └── generator.ts              # 程式碼生成核心
├── types/
│   └── index.ts                  # 型別定義
└── App.tsx                       # 主應用程式
```

---

## 版本歷程

### v1.0.0

- ✅ 基礎編輯器
- ✅ 點對點對應視覺化
- ✅ Lucide 圖示庫整合

### v1.1.0 (當前版本) - 多點路徑系統

- ✅ 多點路徑系統（PathPoint 架構重構）
- ✅ 三種編輯工具：Select / Pen+ / Pen-
- ✅ 路徑編輯功能（插入、延伸、刪除點）
- ✅ 視覺回饋強化（Hover、Focus、Preview、Icon）
- ✅ Toast 通知系統

### v1.2.0 (規劃中) - 動態線段系統

- Sprint 1 功能
- Light Mode 主題切換
- 動態線段數量

### v1.3.0 (規劃中) - 編輯體驗優化

- Sprint 2 功能
- 對齊輔助線
- 樣式自訂面板

---

## 參考資源

- 靈感來源：[Zaku's Pen on CodePen](https://codepen.io/Zaku/pen/ejLNJL)
- GitHub Repo：[reginna-chao/morphbar](https://github.com/reginna-chao/morphbar)
- 圖示庫：[Lucide Icons](https://lucide.dev/)

---

**最後更新**：2025-11-29
**維護者**：@reginna-chao
